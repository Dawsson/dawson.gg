---
import BlogLayout from "@/layouts/blog.astro";
import Nav from "@/components/nav.astro";
import { fetchPublicNotes } from "@/lib/github.ts";
import type { Bindings, Note } from "@/lib/types.ts";

const env = Astro.locals.runtime.env as Bindings;

let notes: Note[];
const cached = await env.CACHE.get("notes:public");
if (cached) {
  notes = JSON.parse(cached) as Note[];
} else {
  notes = await fetchPublicNotes(env);
  await env.CACHE.put("notes:public", JSON.stringify(notes), { expirationTtl: 300 });
}
---

<BlogLayout title="Posts">
  <Nav />
  <div class="home-header">
    <h1>Posts</h1>
    <p>Notes, ideas, and things worth writing down.</p>
  </div>
  <ul class="note-list">
    {notes.map((n) => (
      <li>
        <a href={`/p/${encodeURIComponent(n.path)}`}>{n.title}</a>
      </li>
    ))}
  </ul>
</BlogLayout>
